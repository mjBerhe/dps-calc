import default_style from '../../images/WeaponStyles/default_style.png';
import axes1 from "../../images/WeaponStyles/axes/axes1.png";
import axes2 from "../../images/WeaponStyles/axes/axes2.png";
import axes3 from "../../images/WeaponStyles/axes/axes3.png";
import axes4 from "../../images/WeaponStyles/axes/axes4.png";
import bladed_staves1 from "../../images/WeaponStyles/bladed_staves/bladed_staves1.png";
import bladed_staves2 from "../../images/WeaponStyles/bladed_staves/bladed_staves2.png";
import bladed_staves3 from "../../images/WeaponStyles/bladed_staves/bladed_staves3.png";
import bladed_staves4 from "../../images/WeaponStyles/bladed_staves/bladed_staves4.png";
import bladed_staves5 from "../../images/WeaponStyles/bladed_staves/bladed_staves5.png";
import blunt_weapons1 from "../../images/WeaponStyles/blunt_weapons/blunt_weapons1.png";
import blunt_weapons2 from "../../images/WeaponStyles/blunt_weapons/blunt_weapons2.png";
import blunt_weapons3 from "../../images/WeaponStyles/blunt_weapons/blunt_weapons3.png";
import bows1 from "../../images/WeaponStyles/bows/bows1.png";
import bows2 from "../../images/WeaponStyles/bows/bows2.png";
import bows3 from "../../images/WeaponStyles/bows/bows3.png";
import bulwark1 from "../../images/WeaponStyles/bulwark/bulwark1.png";
import bulwark2 from "../../images/WeaponStyles/bulwark/bulwark2.png";
import chinchompas1 from "../../images/WeaponStyles/chinchompas/chinchompas1.png";
import chinchompas2 from "../../images/WeaponStyles/chinchompas/chinchompas2.png";
import chinchompas3 from "../../images/WeaponStyles/chinchompas/chinchompas3.png";
import claws1 from "../../images/WeaponStyles/claws/claws1.png";
import claws2 from "../../images/WeaponStyles/claws/claws2.png";
import claws3 from "../../images/WeaponStyles/claws/claws3.png";
import claws4 from "../../images/WeaponStyles/claws/claws4.png";
import crossbows1 from "../../images/WeaponStyles/crossbows/crossbows1.png";
import crossbows2 from "../../images/WeaponStyles/crossbows/crossbows2.png";
import crossbows3 from "../../images/WeaponStyles/crossbows/crossbows3.png";
import halberds1 from "../../images/WeaponStyles/halberds/halberds1.png";
import halberds2 from "../../images/WeaponStyles/halberds/halberds2.png";
import halberds3 from "../../images/WeaponStyles/halberds/halberds3.png";
import pickaxes1 from "../../images/WeaponStyles/pickaxes/pickaxes1.png";
import pickaxes2 from "../../images/WeaponStyles/pickaxes/pickaxes2.png";
import pickaxes3 from "../../images/WeaponStyles/pickaxes/pickaxes3.png";
import pickaxes4 from "../../images/WeaponStyles/pickaxes/pickaxes4.png";
import trident_class_weapons1 from "../../images/WeaponStyles/trident_class_weapons/trident_class_weapons1.png";
import trident_class_weapons2 from "../../images/WeaponStyles/trident_class_weapons/trident_class_weapons2.png";
import trident_class_weapons3 from "../../images/WeaponStyles/trident_class_weapons/trident_class_weapons3.png";
import scythes1 from "../../images/WeaponStyles/scythes/scythes1.png";
import scythes2 from "../../images/WeaponStyles/scythes/scythes2.png";
import scythes3 from "../../images/WeaponStyles/scythes/scythes3.png";
import scythes4 from "../../images/WeaponStyles/scythes/scythes4.png";
import slashing_swords1 from "../../images/WeaponStyles/slashing_swords/slashing_swords1.png";
import slashing_swords2 from "../../images/WeaponStyles/slashing_swords/slashing_swords2.png";
import slashing_swords3 from "../../images/WeaponStyles/slashing_swords/slashing_swords3.png";
import slashing_swords4 from "../../images/WeaponStyles/slashing_swords/slashing_swords4.png";
import spears1 from "../../images/WeaponStyles/spears/spears1.png";
import spears2 from "../../images/WeaponStyles/spears/spears2.png";
import spears3 from "../../images/WeaponStyles/spears/spears3.png";
import spears4 from "../../images/WeaponStyles/spears/spears4.png";
import spiked_weapons1 from "../../images/WeaponStyles/spiked_weapons/spiked_weapons1.png";
import spiked_weapons2 from "../../images/WeaponStyles/spiked_weapons/spiked_weapons2.png";
import spiked_weapons3 from "../../images/WeaponStyles/spiked_weapons/spiked_weapons3.png";
import spiked_weapons4 from "../../images/WeaponStyles/spiked_weapons/spiked_weapons4.png";
import stabbing_swords1 from "../../images/WeaponStyles/stabbing_swords/stabbing_swords1.png";
import stabbing_swords2 from "../../images/WeaponStyles/stabbing_swords/stabbing_swords2.png";
import stabbing_swords3 from "../../images/WeaponStyles/stabbing_swords/stabbing_swords3.png";
import stabbing_swords4 from "../../images/WeaponStyles/stabbing_swords/stabbing_swords4.png";
import staves1 from "../../images/WeaponStyles/staves/staves1.png";
import staves2 from "../../images/WeaponStyles/staves/staves2.png";
import staves3 from "../../images/WeaponStyles/staves/staves3.png";
import staves4 from "../../images/WeaponStyles/staves/staves4.png";
import staves5 from "../../images/WeaponStyles/staves/staves5.png";
import thrown_weapons1 from "../../images/WeaponStyles/thrown_weapons/thrown_weapons1.png";
import thrown_weapons2 from "../../images/WeaponStyles/thrown_weapons/thrown_weapons2.png";
import thrown_weapons3 from "../../images/WeaponStyles/thrown_weapons/thrown_weapons3.png";
import two_handed_swords1 from "../../images/WeaponStyles/two_handed_swords/two_handed_swords1.png";
import two_handed_swords2 from "../../images/WeaponStyles/two_handed_swords/two_handed_swords2.png";
import two_handed_swords3 from "../../images/WeaponStyles/two_handed_swords/two_handed_swords3.png";
import two_handed_swords4 from "../../images/WeaponStyles/two_handed_swords/two_handed_swords4.png";
import unarmed1 from "../../images/WeaponStyles/unarmed/unarmed1.png"
import unarmed2 from "../../images/WeaponStyles/unarmed/unarmed2.png"
import unarmed3 from "../../images/WeaponStyles/unarmed/unarmed3.png"
import whips1 from "../../images/WeaponStyles/whips/whips1.png";
import whips2 from "../../images/WeaponStyles/whips/whips2.png";
import whips3 from "../../images/WeaponStyles/whips/whips3.png";

import React, { useState, useEffect } from 'react';
import { Select } from 'react-select-virtualized';
import { customStyles1 } from "./Styles/SelectStyle1";
import useHover from '../../hooks/useHover';

export const SelectAttackStyle = ({ equippedGear, userStats, setUserStats }) => {

	// controls a list of weapon styles for the selected weapon
	const [select, setSelect] = useState({
		name: 'style',
		value: null,
		VCWidth: 0,
		VCHeight: 0,
		VCOpacity: 1,
		options: [],
	})

	const [stylePic, setStylePic] = useState(default_style);

	const styleImages = {
		axes: [axes1, axes2, axes3, axes4],
		bladed_staves: [bladed_staves1, bladed_staves2, bladed_staves3, bladed_staves4, bladed_staves5],
		blunt_weapons: [blunt_weapons1, blunt_weapons2, blunt_weapons3],
		bows: [bows1, bows2, bows3],
		bulwarks: [bulwark1, bulwark2],
		chinchompas: [chinchompas1, chinchompas2, chinchompas3],
		claws: [claws1, claws2, claws3, claws4],
		crossbows: [crossbows1, crossbows2, crossbows3],
		halberds: [halberds1, halberds2, halberds3],
		pickaxes: [pickaxes1, pickaxes2, pickaxes3, pickaxes4],
		'trident-class_weapons': [trident_class_weapons1, trident_class_weapons2, trident_class_weapons3],
		scythes: [scythes1, scythes2, scythes3, scythes4],
		slashing_swords: [slashing_swords1, slashing_swords2, slashing_swords3, slashing_swords4],
		spears: [spears1, spears2, spears3, spears4],
		spiked_weapons: [spiked_weapons1, spiked_weapons2, spiked_weapons3, spiked_weapons4],
		stabbing_swords: [stabbing_swords1, stabbing_swords2, stabbing_swords3, stabbing_swords4],
		staves: [staves1, staves2, staves3, staves4, staves5],
		thrown_weapons: [thrown_weapons1, thrown_weapons2, thrown_weapons3],
		'two-handed_swords': [two_handed_swords1, two_handed_swords2, two_handed_swords3, two_handed_swords4],
		unarmed: [unarmed1, unarmed2, unarmed3],
		whips: [whips1, whips2, whips3],
	}

	const meleeWepTypes = ['axes', 'blunt_weapons', 'bulwarks', 'claws', 'halberds', 'pickaxes', 'polearms', 'scythes', 'slashing_swords', 'spears', 'spiked_weapons', 'stabbing_swords', 'two-handed_swords', 'unarmed', 'whips'];
	const rangedWepTypes = ['bows', 'crossbows', 'thrown_weapons', 'chinchompas'];
	const magicWepTypes = ['staves', 'bladed_staves', 'trident-class_weapons'];

	const rangedAttStyles = ['accurate', 'rapid', 'longrange', 'short fuse', 'medium fuse', 'long fuse'];

	// for loading style options once weapon is selected
	// whenever weapon changes, style pic resets and some stats are reset
	useEffect(() => {
		const loadOptions = () => {
			const options = [];
			if (equippedGear.weapon) {
				// checking if equipped weapon is a melee weapon
				if (meleeWepTypes.includes(equippedGear.weapon.wepType)) {
					Object.keys(equippedGear.weapon.stances).forEach(stance => {
						options.push({
							value: parseInt(stance.substring(6, 7), 10),
							label: `${equippedGear.weapon.stances[stance].attType} - ${equippedGear.weapon.stances[stance].attStyle}`,
							attType: equippedGear.weapon.stances[stance].attType,
							attStyle: equippedGear.weapon.stances[stance].attStyle,
						});
					});
				// else checking if equipped weapon is a ranged weapon
				} else if (rangedWepTypes.includes(equippedGear.weapon.wepType)) {
					Object.keys(equippedGear.weapon.stances).forEach(stance => {
						options.push({
							value: parseInt(stance.substring(6, 7), 10),
							label: `ranged - ${equippedGear.weapon.stances[stance].cmbStyle}`,
							attType: 'range',
							attStyle: equippedGear.weapon.stances[stance].cmbStyle,
						});
					});
				// else checking if equipped weapon is a magic weapon
				} else if (magicWepTypes.includes(equippedGear.weapon.wepType)) {
					Object.keys(equippedGear.weapon.stances).forEach(stance => {
						if (equippedGear.weapon.wepType === 'trident-class_weapons') {
							options.push({
								value: parseInt(stance.substring(6, 7), 10),
								label: `magic - ${equippedGear.weapon.stances[stance].cmbStyle}`,
								attType: 'magic',
								attStyle: equippedGear.weapon.stances[stance].cmbStyle,
							});
						} else {
							options.push({
								value: parseInt(stance.substring(6, 7), 10),
								label: `${equippedGear.weapon.stances[stance].attType} - ${equippedGear.weapon.stances[stance].attStyle}`,
								attType: equippedGear.weapon.stances[stance].attType,
								attStyle: equippedGear.weapon.stances[stance].attStyle,
							});
						}
					});
				}

				setSelect(prevSelect => ({
					...prevSelect,
					options: options,
				}));
			// should occur when armor set is cleared
			} else {
				setSelect(prevSelect => ({
					...prevSelect,
					options: [],
				}))
			}
		}
		loadOptions();

		setStylePic(default_style);

		setUserStats(prevStats => ({
			...prevStats,
			attType: null,
			attStyle: null,
			isMagic: false,
			isRange: false,
		}));

	}, [equippedGear.weapon])

	// when a style is chosen, userStats gets updated with the specific attack type and attack style
	// spellcasting and defensive casting are converted simply to magic
	const handleStyleChange = option => {
		if (option) {
			// if selecting a casting style on a magic staff
			if (option.attType === 'spellcasting' || option.attType === 'defensive casting') {
				setUserStats(prevStats => ({
					...prevStats,
					attType: 'magic',
					attStyle: option.attStyle,
					isMagic: true,
					isRange: false,
				}));
			// if using a trident-type weapon, make sure chosenSpell is turned off
			} else if (equippedGear.weapon.wepType === 'trident-class_weapons') {
				setUserStats(prevStats => ({
					...prevStats,
					attType: 'magic',
					attStyle: option.attStyle,
					isMagic: true,
					isRange: false,
					chosenSpell: null,
				}));
			// if the currently equipped weapon is ranged and a style was chosen, turn isRange to true
			// double checking because tridents share similar attStyle
			} else if (rangedWepTypes.includes(equippedGear.weapon.wepType)) {
				if (rangedAttStyles.includes(option.attStyle)) {
					setUserStats(prevStats => ({
						...prevStats,
						attType: option.attType,
						attStyle: option.attStyle,
						isRange: true,
						isMagic: false,
						chosenSpell: null,
					}));
				}
			// else, should be melee
			} else {
				setUserStats(prevStats => ({
					...prevStats,
					attType: option.attType,
					attStyle: option.attStyle,
					isMagic: false,
					isRange: false,
					chosenSpell: null,
				}));
			}

			if (equippedGear.weapon) {
				setStylePic(styleImages[equippedGear.weapon.wepType][option.value]);
			}
		}
	}

	const handleMenuOpen = () => {
		setSelect(prevSelect => ({
			...prevSelect,
			VCWidth: 180,
			VCHeight: 'auto',
			VCOpacity: 1,
		}));
	}

	const handleMenuClose = () => {
		setSelect(prevSelect => ({
			...prevSelect,
			VCWidth: 0,
			VCHeight: 0,
			VCOpacity: 0,
		}));
	}

	const [ref, hovered] = useHover();

	return(
		<div className="style-slot">
			<img src={stylePic} alt="selected style" ref={ref}/>
			{hovered && userStats.attStyle && 
				<div className='style-hover'>
					<h5>{`${userStats.attType} - ${userStats.attStyle}`}</h5>
				</div>
			}
			<Select
				className="style-select"
				placeholder="Search for style"
				isSearchable
				onChange={selectedOption => handleStyleChange(selectedOption)}
				onMenuOpen={() => handleMenuOpen()}
				onMenuClose={() => handleMenuClose()}
				options={select.options}
				// value={select2.options[0]}
				styles={customStyles1(select)}
			/>
		</div>
	)
}